// Lake 20160323
// https://hellolake.duapp.com
// https://github.com/hellolake/lake.js
!function(){var m,r;window.lake||(window.lake={}),lake.whats=function(a,b){return!0!==b&&1==a.nodeType?"HTMLElement":Object.prototype.toString.call(a).replace(/[\[\]\s]|object/g,"")},lake.select=function(a){if(a===window||9==a.nodeType||1==a.nodeType)return a;if(/(window|document)/.test(a))return eval(a);var c,b=[];if("string"==typeof a)c=document.querySelectorAll(a);else if("HTMLCollection"==this.whats(a)||"NodeList"==this.whats(a))c=a;else{if("Array"!=this.whats(a)&&"Object"!=this.whats(a))return console.error("Argument:"+a+" can not be selected."),null;this.each(a,function(a){1==a.nodeType&&b.push(a)}),c=b}return 1==c.length?c[0]:1<c.length?c:(console.error("No selectable element in: "+a+"."),null)},lake.each=function(a,b,c){if(a.length){var d;if(!0===c)for(c=a.length;c--;)b(a[c],c);else for(c=0,d=a.length;d>c;c++)b(a[c],c)}else if("Object"==this.whats(a))for(d in a)a.hasOwnProperty(d)&&b(a[d],d);else console.error("Arg[0]:"+a+" can not be traversed.")},lake.offset=function(a,b){var e,c=this.select(a),d=b?this.select(b):void 0;if(1==c.nodeType){if(e=c.getBoundingClientRect(),!d||9==d.nodeType)return c=c.ownerDocument.documentElement.getBoundingClientRect(),{top:e.top-c.top,left:e.left-c.left};if(d===window)return{top:e.top,left:e.left};if(1==d.nodeType)return c=d.getBoundingClientRect(),{top:e.top-c.top,left:e.left-c.left};console.error("Arg[1]:"+b+" is not an element.")}else console.error("Arg[0]:"+a+"is not an element.")},lake.css=function(a,b,c){!0!==c?(a=this.select(a),a.length?this.each(a,function(a){a.style.cssText+=";"+b}):a.style.cssText+=";"+b):"string"==typeof a?(this.style||(this.style=document.createElement("style"),document.head.appendChild(this.style)),this.style.innerHTML+=a+"{"+b+"}"):console.error("Arg[0]:obj must be a selector string when enable internal.")},lake.match=function(a,b,c,d){if("string"==typeof b){var e=function(a,b){return/^\.\w+$/.test(b)?a.classList.contains(b.replace(/\./,"")):/^#\w+$/.test(b)?a.id==b.replace(/#/,""):/^\w+$/.test(b)?a.tagName==b.toUpperCase():/:first-child$/.test(b)?e(a,b.replace(/:first-child$/,""))&&a.parentNode.firstElementChild===a:/:last-child$/.test(b)?e(a,b.replace(/:last-child$/,""))&&a.parentNode.lastElementChild===a:void 0},f=d?d:document,g={};return c&&c.nodeType&&(f=c),this.each(b.split(","),function(b){var d,h,i,j,k,l,m,n;for(d=a,h=!0,i=b.replace(/\s*([>\+~])\s*/g,"$1").match(/\S+/g),j=i.length;j--;){for(k=d,l=i[j].match(/[>\+~]|[#.]?\w+(?::\S+|\[\S+])?/g),m=l.length;m--;)if(n=l[m],/^[\.#]?\w+(?::\S+|\[\S+])?$/.test(n)){if(k.nodeType){if(!e(k,n)){h=!1;break}}else if(k.length){for(h=!1,l=0,m=k.length;m>l;l++)if(e(k[l],n)){h=!0;break}break}}else if(/^>$/.test(n))k=k.parentNode;else if(/^\+$/.test(n))k=k.previousElementSibling;else if(/^~$/.test(n)){for(n=[],k=k.previousElementSibling;!k;)n.push(k),k=k.previousElementSibling;k=n}if(!h||d===f)break;d=d.parentNode}g[b]=h,c&&"function"==typeof c&&c(h,b)}),g}console.error("Arg[1]:selector must be a selector string.")},lake.listen=function(a,b,c,d){a=this.select(a),a.length?this.each(a,function(a){a.addEventListener(b,c,!0===d)}):a.addEventListener(b,c,!0===d)},lake.deaf=function(a,b,c){a=this.select(a),a.length?this.each(a,function(a){a.removeEventListener(b,c)}):a.removeEventListener(b,c)},lake.ajax=function(a,b,c){var e,f,g,d={type:"",data:null,onloadstart:null,onload:null,onloadend:null,onprogress:null,onabort:null,onerror:null,timeout:5e3,ontimeout:null,asyn:!0,credentials:!1,name:"",password:"",header:null,mime:null};if(c)for(e in c)d[e]=c[e];if(f=new XMLHttpRequest,a=a.toUpperCase(),c=d.data?f.upload:f,d.onloadstart&&c.addEventListener("loadstart",function(a){d.onloadstart(f,a)},!1),d.onload&&c.addEventListener("load",function(a){d.onload(f,a)},!1),d.onloadend&&c.addEventListener("loadend",function(a){d.onloadend(f,a)},!1),d.onprogress&&c.addEventListener("progress",function(a){d.onprogress(f,a)},!1),d.onabort&&c.addEventListener("abort",function(a){d.onabort(f,a)},!1),d.onerror&&c.addEventListener("error",function(a){d.onabort(f,a)},!1),d.ontimeout&&c.addEventListener("timeout",function(a){d.ontimeout(f,a)},!1),f.responseType=d.type,f.withCredentials=d.credentials,f.open(a,b,d.asyn,d.name,d.password),f.timeout=d.timeout,d.header)for(g in d.header)f.setRequestHeader(g,d.header[g]);return d.mime&&f.overrideMimeType(d.mime),f.send(d.data),f},m=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,m.prototype.add=function(a,b){var c=lake.select(a),d=b?b:{attributes:!1,childList:!0,characterData:!1,subtree:!0,attributeOldValue:!1,characterDataOldValue:!1},e=this;e.objs||(e.objs=[]),c.length?lake.each(c,function(a){e.observe(a,d),0>e.objs.indexOf(a)&&lake.objs.push(a)}):(e.observe(c,d),0>e.objs.indexOf(c)&&e.objs.push(c))},m.prototype.del=function(a){if(this.disconnect(),a&&this.objs){var b=lake.select(a),c=this;b.length?lake.each(b,function(a){c.objs=c.objs.filter(function(b){return b!==a})}):c.objs=c.objs.filter(function(a){return a!==b}),0<c.objs.length&&c.on(c.objs)}},lake.mutation=function(a){return new m(a)},r=function(a,b,c,d){var e=this;e.base="string"==typeof a?a.trim().replace(/\s+/g," ").replace(/\s*([>\+~])\s*/g,"$1"):a,e.event={},e.target={},e.main=function(a){var b=this;"{}"!=JSON.stringify(e.event)&&0<e.event[a.type].length&&lake.each(e.event[a.type],function(b){b(a)}),"{}"!=JSON.stringify(e.target)&&e.target[a.type]&&lake.each(e.target[a.type],function(c,d){0<c.length&&lake.match(a.target,d,function(b){b&&lake.each(c,function(b){b(a)})},b)})},b&&c&&(e.event[b]=[c],lake.listen(e.base,b,e.main,d))},r.prototype={add:function(a,b,c,d){if("string"==typeof a&&"string"==typeof b&&"function"==typeof c){if(!document.querySelector(a))return console.error("Arg[0]:target must be an available selector string."),void 0;a=a.trim().replace(/\s+/g," ").replace(/\s*([>+~])\s*/g,"$1")}else{if("string"!=typeof a||"function"!=typeof b)return console.error("Arguments must be like : (target,event,fn[,capture]) or (event,fn[,capture])"),void 0;d=c,c=b,b=a,a=void 0}this.event[b]||(this.event[b]=[],lake.listen(this.base,b,this.main,d)),a&&a!==this.base?this.target[b]?this.target[b][a]?0>this.target[b][a].indexOf(c)&&this.target[b][a].push(c):this.target[b][a]=[c]:(this.target[b]={},this.target[b][a]=[c]):a&&a!==this.base||0>this.event[b].indexOf(c)&&this.event[b].push(c)},del:function(a,b,c){var e,d=this;a?"string"==typeof a&&document.querySelector(a)?"string"==typeof b&&"function"==typeof c?(e=d.target[b][a],b=e.indexOf(c),b>-1&&e.splice(b,1)):"string"!=typeof b||c?b||lake.each(d.target,function(b){b[a]&&delete b[a]}):delete d.target[b][a]:"string"==typeof a?"function"==typeof b?(e=d.event[a],b=e.indexOf(b),b>-1&&e.splice(b,1)):b||d.event[a].splice(0):console.error("Arguments must be like: (target,event,fn) or (target,event) or (target) to delete child event. (event,fn) or (event) to delete self event."):lake.each(d.event,function(a,b){lake.deaf(d.base,b,d.main),delete d.event[b],delete d.target[b]})}},lake.listener=function(a,b,c,d){return new r(a,b,c,d)}}();
