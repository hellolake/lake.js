// Lake 20160304
// https://github.com/hellolake/lake.js
(function(){window.lake||(window.lake={});lake.whats=function(a,c){return!0!==c&&1==a.nodeType?"HTMLElement":Object.prototype.toString.call(a).replace(/[\[\]\s]|object/g,"")};lake.select=function(a){if(a===window||9==a.nodeType||1==a.nodeType)return a;if(/(window|document)/.test(a))return eval(a);var c,b=[];if("string"==typeof a)c=document.querySelectorAll(a);else if("HTMLCollection"==this.whats(a)||"NodeList"==this.whats(a))c=a;else if("Array"==this.whats(a)||"Object"==this.whats(a))this.each(a,
function(a){1==a.nodeType&&b.push(a)}),c=b;else return console.error("Argument:"+a+" can not be selected."),null;if(1==c.length)return c[0];if(1<c.length)return c;console.error("No selectable element in: "+a+".");return null};lake.each=function(a,c,b){if(a.length){var d;if(!0===b)for(b=a.length;b--;)c(a[b],b);else for(b=0,d=a.length;b<d;b++)c(a[b],b)}else if("Object"==this.whats(a))for(d in a)a.hasOwnProperty(d)&&c(a[d],d);else console.error("Arg[0]:"+a+" can not be traversed.")};lake.offset=function(a,
c){var b=this.select(a),d=c?this.select(c):void 0;if(1==b.nodeType){var e=b.getBoundingClientRect();if(d&&9!=d.nodeType){if(d===window)return{top:e.top,left:e.left};if(1==d.nodeType)return b=d.getBoundingClientRect(),{top:b.top-e.top,left:b.left-e.left};console.error("Arg[1]:"+c+" is not an element.")}else return{top:e.top+b.ownerDocument.body.scrollTop,left:e.left+b.ownerDocument.body.scrollLeft}}else console.error("Arg[0]:"+a+"is not an element.")};lake.css=function(a,c,b){!0!==b?(a=this.select(a),
a.length?this.each(a,function(a){a.style.cssText+=";"+c}):a.style.cssText+=";"+c):"string"==typeof a?(this.style||(this.style=document.createElement("style"),document.head.appendChild(this.style)),this.style.innerHTML+=a+"{"+c+"}"):console.error("Arg[0]:obj must be a selector string when enable internal.")};lake.match=function(a,c,b,d){if("string"==typeof c){var e=function(a,b){if(/^\.\w+$/.test(b))return a.classList.contains(b.replace(/\./,""));if(/^#\w+$/.test(b))return a.id==b.replace(/#/,"");
if(/^\w+$/.test(b))return a.tagName==b.toUpperCase();if(/:first-child$/.test(b))return e(a,b.replace(/:first-child$/,""))&&a.parentNode.firstElementChild===a;if(/:last-child$/.test(b))return e(a,b.replace(/:last-child$/,""))&&a.parentNode.lastElementChild===a},f=d?d:document,n={};b&&b.nodeType&&(f=b);this.each(c.split(","),function(c){for(var d=a,k=!0,q=c.replace(/\s*([>\+~])\s*/g,"$1").match(/\S+/g),m=q.length;m--;){for(var g=d,l=q[m].match(/[>\+~]|[#.]?\w+(?::\S+|\[\S+])?/g),p=l.length;p--;){var h=
l[p];if(/^[\.#]?\w+(?::\S+|\[\S+])?$/.test(h))if(g.nodeType){if(!e(g,h)){k=!1;break}}else{if(g.length){k=!1;l=0;for(p=g.length;l<p;l++)if(e(g[l],h)){k=!0;break}break}}else if(/^>$/.test(h))g=g.parentNode;else if(/^\+$/.test(h))g=g.previousElementSibling;else if(/^~$/.test(h)){h=[];for(g=g.previousElementSibling;!g;)h.push(g),g=g.previousElementSibling;g=h}}if(k&&d!==f)d=d.parentNode;else break}n[c]=k;b&&"function"==typeof b&&b(k,c)});return n}console.error("Arg[1]:selector must be a selector string.")};
lake.listen=function(a,c,b,d){a=this.select(a);a.length?this.each(a,function(a){a.addEventListener(c,b,!0===d)}):a.addEventListener(c,b,!0===d)};lake.deaf=function(a,c,b){a=this.select(a);a.length?this.each(a,function(a){a.removeEventListener(c,b)}):a.removeEventListener(c,b)};lake.ajax=function(a,c,b){var d={type:"",data:null,onloadstart:null,onload:null,onloadend:null,onprogress:null,onabort:null,onerror:null,timeout:5E3,ontimeout:null,asyn:!0,credentials:!1,name:"",password:"",header:null,mime:null};
if(b)for(var e in b)d[e]=b[e];var f=new XMLHttpRequest;a=a.toUpperCase();b=d.data?f.upload:f;d.onloadstart&&b.addEventListener("loadstart",function(a){d.onloadstart(f,a)},!1);d.onload&&b.addEventListener("load",function(a){d.onload(f,a)},!1);d.onloadend&&b.addEventListener("loadend",function(a){d.onloadend(f,a)},!1);d.onprogress&&b.addEventListener("progress",function(a){d.onprogress(f,a)},!1);d.onabort&&b.addEventListener("abort",function(a){d.onabort(f,a)},!1);d.onerror&&b.addEventListener("error",
function(a){d.onabort(f,a)},!1);d.ontimeout&&b.addEventListener("timeout",function(a){d.ontimeout(f,a)},!1);f.responseType=d.type;f.withCredentials=d.credentials;f.open(a,c,d.asyn,d.name,d.password);f.timeout=d.timeout;if(d.header)for(var n in d.header)f.setRequestHeader(n,d.header[n]);d.mime&&f.overrideMimeType(d.mime);f.send(d.data);return f};var m=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;m.prototype.add=function(a,c){var b=lake.select(a),d=c?c:{attributes:!1,
childList:!0,characterData:!1,subtree:!0,attributeOldValue:!1,characterDataOldValue:!1},e=this;e.objs||(e.objs=[]);b.length?lake.each(b,function(a){e.observe(a,d);0>e.objs.indexOf(a)&&lake.objs.push(a)}):(e.observe(b,d),0>e.objs.indexOf(b)&&e.objs.push(b))};m.prototype.del=function(a){this.disconnect();if(a&&this.objs){var c=lake.select(a),b=this;c.length?lake.each(c,function(a){b.objs=b.objs.filter(function(b){return b!==a})}):b.objs=b.objs.filter(function(a){return a!==c});0<b.objs.length&&b.on(b.objs)}};
lake.mutation=function(a){return new m(a)};var r=function(a,c,b,d){var e=this;e.base="string"==typeof a?a.trim().replace(/\s+/g," ").replace(/\s*([>\+~])\s*/g,"$1"):a;e.event={};e.target={};e.main=function(a){var b=this;"{}"!=JSON.stringify(e.event)&&0<e.event[a.type].length&&lake.each(e.event[a.type],function(b){b(a)});"{}"!=JSON.stringify(e.target)&&e.target[a.type]&&lake.each(e.target[a.type],function(c,d){0<c.length&&lake.match(a.target,d,function(b){b&&lake.each(c,function(b){b(a)})},b)})};c&&
b&&(e.event[c]=[b],lake.listen(e.base,c,e.main,d))};r.prototype={add:function(a,c,b,d){if("string"==typeof a&&"string"==typeof c&&"function"==typeof b){if(!document.querySelector(a)){console.error("Arg[0]:target must be an available selector string.");return}a=a.trim().replace(/\s+/g," ").replace(/\s*([>+~])\s*/g,"$1")}else if("string"==typeof a&&"function"==typeof c)d=b,b=c,c=a,a=void 0;else{console.error("Arguments must be like : (target,event,fn[,capture]) or (event,fn[,capture])");return}this.event[c]||
(this.event[c]=[],lake.listen(this.base,c,this.main,d));a&&a!==this.base?this.target[c]?this.target[c][a]?0>this.target[c][a].indexOf(b)&&this.target[c][a].push(b):this.target[c][a]=[b]:(this.target[c]={},this.target[c][a]=[b]):a&&a!==this.base||0>this.event[c].indexOf(b)&&this.event[c].push(b)},del:function(a,c,b){var d=this,e;a?"string"==typeof a&&document.querySelector(a)?"string"==typeof c&&"function"==typeof b?(e=d.target[c][a],c=e.indexOf(b),-1<c&&e.splice(c,1)):"string"!=typeof c||b?c||lake.each(d.target,
function(b){b[a]&&delete b[a]}):delete d.target[c][a]:"string"==typeof a?"function"==typeof c?(e=d.event[a],c=e.indexOf(c),-1<c&&e.splice(c,1)):c||d.event[a].splice(0):console.error("Arguments must be like: (target,event,fn) or (target,event) or (target) to delete child event. (event,fn) or (event) to delete self event."):lake.each(d.event,function(a,b){lake.deaf(d.base,b,d.main);delete d.event[b];delete d.target[b]})}};lake.listener=function(a,c,b,d){return new r(a,c,b,d)}})();
