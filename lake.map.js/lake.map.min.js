// Lake 20160304
// https://github.com/hellolake/lake.js
var bmap_ak = {
    key:"5yG2Ep6NoV7OWUErStfE73El",		//Baidu Map API Key for test, not sure its stability. 测试用AK,不保证其稳定性.
    ver:"2.0"							//Version of API. API版本
};
(function(){window.lake||(window.lake={});lake.map=function(b,a){this.map.ak||(this.map.ak=bmap_ak);if(a)for(var c in a)this.map.ak[c]=a[c];this.map.loaded?b.call(this.map):this.map.fns.push(b);this.map.script||(this.map.script=document.createElement("script"),this.map.script.type="text/javascript",this.map.script.src="http://api.map.baidu.com/api?v="+this.map.ak.ver+"&ak="+this.map.ak.key+"&callback=lake.map.callback",document.body.appendChild(this.map.script))};lake.map.loaded=!1;lake.map.fns=[];
lake.map.callback=function(){window.located=document.createEvent("HTMLEvents");window.located.initEvent("located",!1,!1);var b=this;this.bmap||(this.bmap=function(a,c){function h(){var a=k.getBounds(),b=a.getSouthWest(),a=a.getNorthEast(),b=k.getDistance(b,a),a=k.getSize();k.resolution=b/Math.sqrt(Math.pow(a.width,2)+Math.pow(a.height,2))}function f(){k.addOverlay(l.marker);k.addOverlay(l.circle);document.removeEventListener("located",f,!0)}function g(a){"function"==typeof l.marker.update&&l.marker.update(a.type,
lake.map.location,lake.map.accuracy);"function"==typeof l.circle.update&&l.circle.update(a.type,lake.map.location,lake.map.accuracy)}BMap.Map.call(this,a,c);this.inited=!1;this.fns=[];this.resolution=null;var k=this,l=k.user;k.addEventListener("moveend",h,!0);k.addEventListener("zoomend",h,!0);var m=document.createElement("div");m.style.cssText="padding:8px;background-color:#0af;border:.125em solid #fff;border-radius:50%;box-shadow:0 0 3px rgba(0,0,0,.3);position;absolute;z-index:909;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);display:none;";
l.marker=b.overlay(m,{oninit:function(){this.update=function(a,b){"located"==a&&this.setPosition(b)}}});m=document.createElement("div");m.style.cssText="padding:0;background-color:rgba(0,0,0,.125);border-radius:50%;position;absolute;z-index:808;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);display:none;";l.circle=b.overlay(m,{oninit:function(){this.update=function(a,b,c){"located"==a&&this.setPosition(b);this.obj.style.padding=c/this.map.resolution+"px"}}});lake.map.location?
f():document.addEventListener("located",f,!0);document.addEventListener("located",g);k.addEventListener("moveend",g);k.addEventListener("zoomend",g)},this.bmap.prototype=new BMap.Map,this.bmap.prototype.constructor=this.bmap,this.bmap.prototype.setCenter=function(a){function b(){BMap.Map.prototype.setCenter.call(c,a)}var c=this;c.inited?b():c.fns.push(b)},this.bmap.prototype.setZoom=function(a){function b(){BMap.Map.prototype.setZoom.call(c,a)}var c=this;c.inited?b():c.fns.push(b)},this.bmap.prototype.user=
function(a,b){function c(a){if(lake.map.location)f.addOverlay(a);else{var b=function(){f.addOverlay(a);document.removeEventListener("located",b,!0)};document.addEventListener("located",b,!0)}}var f=this,g=f.user;a instanceof BMap.Overlay&&(f.removeOverlay(g.marker),g.marker=a,c(g.marker));b instanceof BMap.Overlay&&(f.removeOverlay(g.circle),g.circle=b,c(g.circle));!1===a&&(f.removeOverlay(g.marker),g.marker=null);!1===b&&(f.removeOverlay(g.circle),g.circle=null)});this.loaded=!0;for(var a=0,c=this.fns.length;a<
c;a++)this.fns[a].call(this)};lake.map.new=function(b,a,c,d){if(this.loaded){"[object Object]"===Object.prototype.toString.call(c)&&(d=c,c=void 0);"number"==typeof a&&(c=a,a=void 0);"[object Object]"!==Object.prototype.toString.call(a)||a instanceof BMap.Point||(d=a,a=void 0);c||(c=15);if("string"==typeof b)b=document.querySelector(b);else if(1!=b.nodeType){console.error("Arg[0]:Container must be a selector string or an element.");return}var e=new this.bmap(b,d);e.enableScrollWheelZoom();e.enableContinuousZoom();
if(a instanceof BMap.Point)e.centerAndZoom(a,c),e.inited=!0;else if(e.centerAndZoom(new BMap.Point(116.404,39.915),10),a)if("string"==typeof a){var h=e.getContainer().firstChild;h.style.display="none";var f=new BMap.LocalSearch("\u4e2d\u56fd");f.setSearchCompleteCallback(function(a){if(0!==f.getStatus())console.error("Arg[1]:Unknown location.");else if(e.centerAndZoom(a.getPoi(0).point,c),h.style.display="",e.inited=!0,a=e.fns.length,0<a){for(var b=0;b<a;b++)e.fns[b]();e.fns=[]}});f.search(a)}else console.error("Arg[1]:Location must be a location name or BMap Point.");
else e.inited=!0;return e}console.error("Create map must run in callback fn with 'lake.map(callback)'.")};lake.map.gps=function(b,a,c){if(lake.map.loaded){var d=this.gps;d.enableHighAccuracy=!0;d.timeout=3E4;d.maximumAge=7E3;d.success=[];d.error=[];"[object Object]"===Object.prototype.toString.call(a)&&(c=a,a=void 0);"[object Object]"===Object.prototype.toString.call(b)&&(c=b,a=b=void 0);if("[object Object]"===Object.prototype.toString.call(c))for(var e in c)d[e]=c[e];"function"==typeof a&&(d.error=
[a]);"function"==typeof b&&(d.success=[b]);d.geo||(d.geo=new BMap.Geolocation);d.interval&&d.stop()}else console.error("BMap Geolocation must run in callback fn with 'lake.map(callback)'.")};lake.map.gps.locate=function(){if(this.geo){var b=this;b.geo.getCurrentPosition(function(a){if(this.getStatus()==BMAP_STATUS_SUCCESS){lake.map.location=a.point;lake.map.accuracy=a.accuracy;document.dispatchEvent(located);for(var c=0,d=b.success.length;c<d;c++)b.success[c].call(b,a)}else for(a=0,c=b.error.length;a<
c;a++)b.error[a].call(b,this.getStatus())},{enableHighAccuracy:b.enableHighAccuracy,timeout:b.timeout,maximumAge:b.maximumAge})}else console.error("Use 'lake.map.gps(success,error,options)' to initialize the GPS first.")};lake.map.gps.run=function(){if(this.geo){this.interval?this.stop():this.locate();var b=this;this.interval=setInterval(function(){b.locate()},b.maximumAge+100)}else console.error("Use 'lake.map.gps(success,error,options)' to initialize the GPS first.")};lake.map.gps.stop=function(){clearInterval(this.interval);
this.interval=null};lake.map.gps.add=function(b,a){"string"==typeof b&&"function"==typeof a&&("success"===b?0>this.success.indexOf(a)&&this.success.push(a):"error"===b&&0>this.error.indexOf(a)&&this.error.push(a))};lake.map.gps.del=function(b,a){"string"==typeof b&&("function"==typeof a?"success"===b?this.success.splice(this.success.indexOf(a),1):"error"===b&&this.error.splice(this.error.indexOf(a),1):a||("success"===b?this.success=[]:"error"===b&&(this.error=[])))};lake.map.geo=function(b,a,c){this.geo.enableHighAccuracy=
!0;this.geo.timeout=3E4;this.geo.maximumAge=7E3;this.geo.success=[];this.geo.error=[];"[object Object]"===Object.prototype.toString.call(a)&&(c=a,a=void 0);"[object Object]"===Object.prototype.toString.call(b)&&(c=b,a=b=void 0);if("[object Object]"===Object.prototype.toString.call(c))for(var d in c)this.geo[d]=c[d];"function"==typeof a&&(this.geo.error=[a]);"function"==typeof b&&(this.geo.success=[b]);this.geo.watch&&this.geo.stop()};lake.map.geo._success=function(b){var a=lake.map.geo;lake.map.loaded&&
(lake.map.c2bp(b.coords,function(a){lake.map.location=a;document.dispatchEvent(located)}),lake.map.accuracy=b.coords.accuracy);for(var c=0,d=a.success.length;c<d;c++)a.success[c].call(a,b)};lake.map.geo._error=function(b){for(var a=lake.map.geo,c=0,d=a.error.length;c<d;c++)a.error[c].call(a,b)};lake.map.geo.locate=function(){this.watch&&this.stop();navigator.geolocation.getCurrentPosition(this._success,this._error,{enableHighAccuracy:this.enableHighAccuracy,timeout:this.timeout,maximumAge:this.maximumAge})};
lake.map.geo.run=function(){this.watch&&this.stop();this.watch=navigator.geolocation.watchPosition(this._success,this._error,{enableHighAccuracy:this.enableHighAccuracy,timeout:this.timeout,maximumAge:this.maximumAge})};lake.map.geo.stop=function(){navigator.geolocation.clearWatch(this.watch);this.watch=null};lake.map.geo.add=function(b,a){"string"==typeof b&&"function"==typeof a&&("success"===b?0>this.success.indexOf(a)&&this.success.push(a):"error"===b&&0>this.error.indexOf(a)&&this.error.push(a))};
lake.map.geo.del=function(b,a){"string"==typeof b&&("function"==typeof a?"success"===b?this.success.splice(this.success.indexOf(a),1):"error"===b&&this.error.splice(this.error.indexOf(a),1):a||("success"===b?this.success=[]:"error"===b&&(this.error=[])))};lake.map.c2bp=function(b,a,c){function d(b){if(0===b.status)for(var g=0,k=b.points.length;g<k;g++)a(b.points[g]);else c&&c(b.message)}var e=!0,h=[];(function g(a){if(2==a.length&&"number"==typeof a[0]&&"number"==typeof a[1])h.push(new BMap.Point(a[0],
a[1]));else if(a.lng&&a.lat)h.push(new BMap.Point(a.lng,a.lat));else if(a.longitude&&a.latitude)h.push(new BMap.Point(a.longitude,a.latitude));else if(a.length)for(var b=0,c=a.length;b<c&&e;b++)g(a[b]);else e=!1,console.error("Can not convert "+a+".")})(b);e&&(new BMap.Convertor).translate(h,1,5,d)};lake.map.overlay=function(b,a,c){var d=null,e=null,h=!1,f=!1;"[object Object]"!==Object.prototype.toString.call(a)||a instanceof BMap.Point||(c=a,a=void 0);c&&!0===c.drag&&(h=!0);c&&!0===c.selectable&&
(f=!0);c&&"function"==typeof c.oninit&&(d=c.oninit);c&&"function"==typeof c.ondraw&&(e=c.ondraw);if(!(a instanceof BMap.Point)){if(a){console.error("Arg[1]:point must be a BMap Point or empty.");return}a=new BMap.Point(0,0)}if(1!=b.nodeType)if("string"==typeof b)b=document.querySelector(b);else{console.error("Arg[0]:obj must be a selector string or an element.");return}this.overlay._overlay||(this.overlay._overlay=function(a,b,c,d,e,f){this.obj=a;this.point=b;this.drag=e;this.selectable=f;this.oninit=
c;this.ondraw=d},this.overlay._overlay.prototype=new BMap.Overlay,this.overlay._overlay.prototype.constructor=this.overlay._overlay,this.overlay._overlay.prototype.initialize=function(a){this.map=a;a.getPanes().labelPane.appendChild(this.obj);this.obj.style.position="absolute";var b=this;this.obj.addEventListener("click",function(a){!0===b.selectable&&a.stopImmediatePropagation();b.dispatchEvent("click")});this.obj.addEventListener("dblclick",function(a){!0===b.selectable&&a.stopImmediatePropagation();
b.dispatchEvent("dblclick")});this.obj.addEventListener("mousedown",function(a){!0===b.selectable&&a.stopImmediatePropagation();b.dispatchEvent("mousedown")});this.obj.addEventListener("mouseup",function(a){!0===b.selectable&&a.stopImmediatePropagation();b.dispatchEvent("mouseup")});this.obj.addEventListener("mouseout",function(a){!0===b.selectable&&a.stopImmediatePropagation();b.dispatchEvent("mouseout")});this.obj.addEventListener("mouseover",function(a){!0===b.selectable&&a.stopImmediatePropagation();
b.dispatchEvent("mouseover")});this.oninit&&this.oninit.call(this,this);return this.obj},this.overlay._overlay.prototype.draw=function(){var a=this.map.pointToOverlayPixel(this.point);this.obj.style.left=a.x+"px";this.obj.style.top=a.y+"px";this.ondraw&&this.ondraw.call(this,this)},this.overlay._overlay.prototype.setPosition=function(a){a instanceof BMap.Point&&(this.point=a,this.map&&this.draw())},this.overlay._overlay.prototype.getPosition=function(){return this.point},this.overlay._overlay.prototype.getMap=
function(){return this.map},this.overlay._overlay.prototype.getObj=function(){return this.obj});return new this.overlay._overlay(b,a,d,e,h,f)}})();
